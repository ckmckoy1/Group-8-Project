<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout | Wild Path Outfitters</title>
    <link rel="stylesheet" href="../css/CustomerStyle.css">
    <link rel="icon" href="../assets/compass.png" type="image/png">
</head>

<body>
    <header class="header">
        <div class="promo-bar">
            <p>Earn Rewards On Purchases | FALL OUTERWEAR 20-40% OFF | <a href="#">VIEW DEALS</a> | 
            <img src="../assets/location.svg" width="25" height="25"> The Outlet Shoppes at Atlanta  |  
            <img src="../assets/account.svg" width="25" height="25"> <a href="#">Sign In / Sign Up </a></p>
        </div>
    </header>

    <!-- Top Bar with Search, Logo, and Cart -->
    <div class="top-bar">
        <div class="search-bar">
            <input type="text" placeholder="Search...">
            <img src="../assets/search.svg" width="20" height="20" alt="Search">
        </div>
        <div class="logo">
            <h1>Wild Path Outfitters <img src="../assets/compass-svgrepo-com.svg" width="50" height="50" alt="Compass"></h1>
        </div>
        <div class="cart-icon">
            <a href="../cart.html">
                <img src="../assets/cart.svg" width="20" height="20" alt="Shopping Cart Icon">
            </a>
        </div>
    </div>

    <div class="banner">
        <nav class="nav">
            <a href="#">Women</a>
            <a href="#">Men</a>
            <a href="#">Kids</a>
            <a href="#">Gear & Home</a>
            <a href="#">Shoes</a>
            <a href="#">Clearance</a>
            <a href="#">About Us</a>
        </nav>
    </div>

    <!-- Popup for Order Complete -->
    <div class="popup-overlay" id="orderPopupOverlay" style="display: none;">
        <div class="popup" id="orderPopup">
            <span class="close" id="closeOrderPopup">&times;</span>
            <div class="popup-content">
                <p>Your order is complete! Thank you for shopping with Wild Path Outfitters.</p>
            </div>
        </div>
    </div>

    <main class="main-content">
        <div class="container">    
            <section class="checkout-container">
                <h2>Secure Checkout</h2>
                <div class="sign-in">
                    <p>Sign in to your account to save time and earn rewards. | No Account? <a href="#">Sign up now</a></p>
                    <a href="#">+ Add my Adventure Rewards Number</a>
                </div>

                <div class="checkout-content">
                    <!-- Left Column: Form for Checkout Sections -->
                    <div class="checkout-form-section">
                        <form id="checkoutForm" onsubmit="return validateForm()">
                            <!-- Section 1: Shipping & Billing Details -->
                            <div id="shippingBillingSection" class="form-section">
                                <h3 onclick="toggleSection('shippingBillingSection')">1. SHIPPING & BILLING DETAILS</h3>
                                <div class="form-content">
                                    <div class="form-group">
                                        <label for="email">Email:</label>
                                        <input type="email" id="email" name="email" required placeholder="Enter your email">
                                    </div>
                                    <div class="form-group">
                                        <label for="phone">Phone Number:</label>
                                        <input type="tel" id="phone" name="phone" required placeholder="For delivery purposes only">
                                    </div>
                                    <div class="form-group">
                                        <label for="firstName">First Name:</label>
                                        <input type="text" id="firstName" name="firstName" required placeholder="First Name">
                                    </div>
                                    <div class="form-group">
                                        <label for="lastName">Last Name:</label>
                                        <input type="text" id="lastName" name="lastName" required placeholder="Last Name">
                                    </div>
                                    <div class="form-group">
                                        <label for="address">Shipping Address:</label>
                                        <input type="text" id="address" name="address" required placeholder="Start typing your street address">
                                    </div>
                                    <div class="form-group">
                                        <label for="unitNumber">Unit Number, Suite, Floor (Optional):</label>
                                        <input type="text" id="unitNumber" name="unitNumber" placeholder="Unit, Suite, Floor">
                                    </div>
                                    <div class="form-group">
                                        <label for="city">City:</label>
                                        <input type="text" id="city" name="city" required placeholder="City">
                                    </div>
                                    <div class="form-group">
                                        <label for="state">State / Region:</label>
                                        <input type="text" id="state" name="state" required placeholder="State / Region">
                                    </div>
                                    <div class="form-group">
                                        <label for="zip">ZIP / Postal Code:</label>
                                        <input type="text" id="zip" name="zip" required placeholder="ZIP / Postal Code">
                                    </div>
                                    <div class="form-group">
                                        <input type="checkbox" id="sameAsShipping" name="sameAsShipping">
                                        <label for="sameAsShipping">Is the shipping address the same as billing?</label>
                                    </div>
                                    <button type="button" class="continue-btn" onclick="collapseSection('shippingBillingSection', 'shippingMethodSection')">Continue</button>
                                </div>
                            </div>

                            <!-- Section 2: Shipping Method -->
                            <div id="shippingMethodSection" class="form-section collapsed">
                                <h3 onclick="toggleSection('shippingMethodSection')">2. SHIPPING METHOD</h3>
                                <div class="form-content">
                                    <p>Select your preferred shipping method:</p>
                                    <div class="form-group">
                                        <input type="radio" id="standard" name="shippingMethod" value="Standard" required>
                                        <label for="standard">Standard Shipping (5-7 days)</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="radio" id="express" name="shippingMethod" value="Express" required>
                                        <label for="express">Express Shipping (2-3 days)</label>
                                    </div>
                                    <button type="button" class="continue-btn" onclick="collapseSection('shippingMethodSection', 'paymentSection')">Continue</button>
                                </div>
                            </div>

                            <!-- Section 3: Payment -->
                            <div id="paymentSection" class="form-section collapsed">
                                <h3 onclick="toggleSection('paymentSection')">3. PAYMENT</h3>
                                <div class="form-content">
                                    <div class="form-group">
                                        <label for="cardNumber">Credit Card Number:</label>
                                        <input type="text" id="cardNumber" name="cardNumber" required placeholder="Card Number">
                                    </div>
                                    <div class="form-group">
                                        <label for="expDate">Expiration Date (MM/YY):</label>
                                        <input type="text" id="expDate" name="expDate" required placeholder="MM/YY">
                                    </div>
                                    <div class="form-group">
                                        <label for="securityCode">Security Code (CVV):</label>
                                        <input type="text" id="securityCode" name="securityCode" required placeholder="CVV">
                                    </div>
                                    <div class="form-group">
                                        <label for="zipCode">Billing ZIP Code:</label>
                                        <input type="text" id="zipCode" name="zipCode" required placeholder="Billing ZIP Code">
                                    </div>
                                    <button type="submit" class="submit-button">Complete Purchase</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- Right Column: Order Summary -->
                <aside class="order-summary">
                    <h3>Order Summary</h3>
                    <p>Items in Cart: 1</p>
                    <p>Total: $43.14</p>
                    <hr>
                    <p>Shipping: $3.99</p>
                    <p>Tax: $2.87</p>
                    <hr>
                    <p><strong>Grand Total: $50.00</strong></p>
                </aside>
            </div>
        </div>
    </main>

    <footer class="footer">
        <nav class="footer-nav">
            <a href="#">Store Locator</a>
            <a href="#">Navigator Rewards</a>
            <a href="#">Help</a>
            <a href="#">Customer Service</a>
            <a href="#">Return Policy</a>
            <a href="#">Shipping</a>
            <a href="#">Contact Us</a>
            <a href="#">Sign In / Register</a>
            <a href="#">Privacy Policy</a>
        </nav>
        <p>&copy; 2024 Wild Path Outfitters. All rights reserved.</p>
    </footer>

    <script>
    // Auto-format phone number as (###) ###-####
document.getElementById('phone').addEventListener('input', function (e) {
    let input = e.target.value.replace(/\D/g, ''); // Remove all non-digit characters
    if (input.length > 0) {
        input = '(' + input.substring(0, 3);
    }
    if (input.length > 4) {
        input += ') ' + input.substring(3, 6);
    }
    if (input.length > 9) {
        input += '-' + input.substring(6, 10);
    }
    e.target.value = input.substring(0, 14); // Limit the length to (###) ###-####
});
    
        // Auto-format expiration date (MM/YY)
        document.getElementById('expDate').addEventListener('input', function (e) {
            let input = e.target.value.replace(/\D/g, ''); // Remove any non-digit characters
            if (input.length > 2) {
                input = input.substring(0, 2) + '/' + input.substring(2, 4);
            }
            e.target.value = input;
        });

        // Auto-format card number as #### #### #### ####
        document.getElementById('cardNumber').addEventListener('input', function (e) {
            let input = e.target.value.replace(/\D/g, ''); // Remove any non-digit characters
            input = input.match(/.{1,4}/g)?.join(' ') || input; // Add space every 4 digits
            e.target.value = input;
        });

        // Copy shipping ZIP code to billing if checkbox is checked
        document.getElementById('sameAsShipping').addEventListener('change', function (e) {
            if (e.target.checked) {
                document.getElementById('zipCode').value = document.getElementById('zip').value;
            } else {
                document.getElementById('zipCode').value = ''; // Clear if unchecked
            }
        });

        function collapseSection(currentSectionId, nextSectionId) {
            const currentSection = document.getElementById(currentSectionId);
            const nextSection = document.getElementById(nextSectionId);
            currentSection.querySelector('.form-content').style.display = 'none';
            nextSection.querySelector('.form-content').style.display = 'block';
        }

        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const content = section.querySelector('.form-content');
            const isVisible = content.style.display === 'block';
            content.style.display = isVisible ? 'none' : 'block';
        }

        function validateForm() {
            const requiredFields = document.querySelectorAll('input[required]');
            for (let field of requiredFields) {
                if (!field.value) {
                    alert(`Please fill out the ${field.name} field.`);
                    return false;
                }
            }
            return true;
        }

        // Handle form submission and show popup for order completion
        document.getElementById('checkoutForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            // Gather form data
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const unitNumber = document.getElementById('unitNumber').value;
            const city = document.getElementById('city').value;
            const state = document.getElementById('state').value;
            const zip = document.getElementById('zip').value;
            const shippingMethod = document.querySelector('input[name="shippingMethod"]:checked').value;
            const cardNumber = document.getElementById('cardNumber').value;
            const expDate = document.getElementById('expDate').value;
            const securityCode = document.getElementById('securityCode').value;
            const billingZipCode = document.getElementById('zipCode').value;

            // Prepare order data for API
            const orderData = {
                firstName,
                lastName,
                email,
                phone,
                address: `${address} ${unitNumber}`,
                city,
                state,
                zip,
                shippingMethod,
                paymentDetails: {
                    cardNumber,
                    expDate,
                    securityCode,
                    billingZipCode
                }
            };

            try {
                // Send data to the API
                const response = await fetch('/api/checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData),
                });

                const result = await response.json();

                if (response.ok) {
                    // Show success popup
                    document.getElementById('orderPopupOverlay').style.display = 'block';
                    alert(`Order submitted successfully! Order ID: ${result.orderId}`);
                } else {
                    alert(`Error: ${result.message}`);
                }
            } catch (error) {
                console.error('Error submitting order:', error);
                alert('Error: Something went wrong!');
            }
        });

        // Close the order popup
        document.getElementById('closeOrderPopup').addEventListener('click', function() {
            document.getElementById('orderPopupOverlay').style.display = 'none';
        });
    </script>
</body>

</html>
