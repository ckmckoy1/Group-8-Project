<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipping Management | Wild Path Outfitters</title>
    <link rel="stylesheet" href="../css/settleShipmentStyle.css">
</head>
<body>
    <header class="header">
        <h1>WPO Shipping Management System</h1>
    </header>

    <main>
        <div class="settle-shipment-container">
            <h2>Order Shipping Settlement</h2>
            <h3>Click the "Scan" button to scan the barcode or enter the Order ID to pull the order. Then enter the Final Amount and click the Settlement Shipment button to settle the order.</h3>
            <form id="settleShipmentForm">
                <div class="form-group">
                    <h3>Step 1: Scan Barcode or Enter Order ID</h3>
                    <small class="info-text"></small>
                    <div class="order-id-container">
                        <button type="button" id="barcodeScanner" class="action-button" aria-label="Scan Barcode">
                            <img src="../assets/barcode-scanner.svg" alt="Scan Barcode Icon" width="24" height="24" class="icon"> Scan
                        </button>
                        <span class="or-text">or</span>
                        <span class="order-id-prefix">WP-</span>
                        <input type="text" id="orderId" name="orderId" placeholder="Order Number" required>
                    </div>
                    <p id="scannerInstructions" class="scanner-instructions" style="display: none;">
                        Please align the barcode within the frame to scan.
                    </p>
                    <div id="loadingSpinner" class="loading-spinner" style="display: none;">
                        <img src="../assets/loading-spinner.gif" alt="Loading..." width="50" height="50">
                        <p>Initializing camera...</p>
                    </div>
                    <video id="scannerVideo" style="display: none;"></video>
                </div>

                <div class="form-group">
                    <h3>Step 2: Enter Final Amount</h3>
                    <input type="number" id="finalAmount" name="finalAmount" placeholder="Final Amount" required step="0.01" min="0">
                </div>
                
                <h3>Step 3: Click Settle Shipment Button</h3>
                <button type="submit" class="submit-button">Settle Shipment</button>

                <div id="message" class="message" style="display: none;"></div>
            </form>
            
            <!-- Print after approval -->
            <button id="printLabel" style="display:none;">Print Shipment Label</button>

            <!-- Order History Section -->
            <div class="order-history-container">
                <h2>Order History</h2>
                <table class="order-history-table">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Approval Date</th>
                            <th>Status</th>
                            <th>Tracking Link</th>
                        </tr>
                    </thead>
                    <tbody id="orderHistoryTableBody">
                        <!-- Order history will be populated here -->
                    </tbody>
                </table>
            </div>

            <!-- Warehouse Status Display -->
            <div class="warehouse-status-container">
                <h2>Warehouse Status</h2>
                <p id="warehouseStatus">Loading status...</p>
            </div>
        </div>
    </main>

    <script src="../js/settleShipment.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.3.1/dist/jsQR.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>
